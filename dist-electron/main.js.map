{"version":3,"file":"main.js","sources":["../electron/main.ts"],"sourcesContent":["import { app, BrowserWindow, dialog, ipcMain } from \"electron\";\nimport path from \"node:path\";\nimport fs from \"node:fs\";\nimport { fileURLToPath } from \"node:url\";\n\nconst __dirname = path.dirname(fileURLToPath(import.meta.url));\n\nlet mainWindow: BrowserWindow | null = null;\n\nfunction createMainWindow() {\n  const iconPathDev = path.join(process.cwd(), \"build\", \"icon.png\");\n\n  // On Windows/Linux, BrowserWindow icon shows in title/taskbar. macOS ignores this and uses app bundle icon.\n  const windowIcon =\n    process.platform === \"win32\" || process.platform === \"linux\"\n      ? iconPathDev\n      : undefined;\n\n  mainWindow = new BrowserWindow({\n    fullscreen: false,\n    backgroundColor: \"#000000\",\n    show: false,\n    icon: windowIcon,\n    // Use hidden inset titleBar on macOS so traffic lights float in content\n    titleBarStyle: process.platform === \"darwin\" ? \"hiddenInset\" : undefined,\n    trafficLightPosition:\n      process.platform === \"darwin\" ? { x: 14, y: 14 } : undefined,\n    webPreferences: {\n      contextIsolation: true,\n      // When running un-packaged (during development), the compiled preload script\n      // lives in the project-root/dist-electron folder. After the app is\n      // packaged the preload will sit next to the compiled main.js inside the\n      // app bundle, so we can reference it directly. Resolve accordingly so\n      // the renderer always gets the preload script and therefore the\n      // window.api bridge.\n      preload: (() => {\n        // Packaged: preload sits next to main.js inside the asar bundle\n        if (app.isPackaged) {\n          return path.join(__dirname, \"preload.js\");\n        }\n\n        // Development: the preload TS gets bundled into dist-electron/preload.js\n        // relative to project root. However depending on whether Electron is\n        // running the built JS or ts-node, __dirname can be either\n        //   - <projectRoot>/electron             (when ts-node executes *.ts)\n        //   - <projectRoot>/dist-electron        (when built JS is executed)\n        // Try both locations and pick the first that exists.\n        const devPath1 = path.join(__dirname, \"../dist-electron/preload.js\");\n        const devPath2 = path.join(__dirname, \"preload.js\");\n        return fs.existsSync(devPath1) ? devPath1 : devPath2;\n      })(),\n    },\n  });\n\n  // Set dock icon on macOS during development\n  if (process.platform === \"darwin\" && !app.isPackaged) {\n    try {\n      app.dock.setIcon(iconPathDev);\n    } catch {}\n  }\n\n  const pageUrl = process.env.VITE_DEV_SERVER_URL;\n  if (pageUrl) {\n    mainWindow.loadURL(pageUrl);\n  } else {\n    mainWindow.loadFile(path.join(__dirname, \"../dist/index.html\"));\n  }\n\n  if (!app.isPackaged) {\n    try {\n      mainWindow.webContents.openDevTools({ mode: \"detach\" });\n    } catch {}\n  }\n\n  // Enable titlebar overlay so the window controls render above the webview\n  if (process.platform === \"darwin\") {\n    try {\n      mainWindow.setTitleBarOverlay({\n        color: \"#00000000\",\n        symbolColor: \"#FFFFFF\",\n        height: 48,\n      });\n    } catch {}\n  }\n\n  mainWindow.once(\"ready-to-show\", () => {\n    mainWindow?.maximize();\n    mainWindow?.show();\n  });\n\n  mainWindow.on(\"closed\", () => {\n    mainWindow = null;\n  });\n}\n\napp.whenReady().then(createMainWindow);\n\n// Simple app-level settings stored under userData\ntype AppSettings = {\n  selectedFolder?: string;\n};\n\nfunction getAppSettingsPath(): string {\n  return path.join(app.getPath(\"userData\"), \"app-settings.json\");\n}\n\nfunction readAppSettings(): AppSettings {\n  try {\n    const filePath = getAppSettingsPath();\n    if (!fs.existsSync(filePath)) return {};\n    const raw = fs.readFileSync(filePath, \"utf-8\");\n    return JSON.parse(raw) as AppSettings;\n  } catch {\n    return {};\n  }\n}\n\nfunction writeAppSettings(settings: AppSettings) {\n  try {\n    const filePath = getAppSettingsPath();\n    fs.mkdirSync(path.dirname(filePath), { recursive: true });\n    fs.writeFileSync(filePath, JSON.stringify(settings, null, 2), \"utf-8\");\n  } catch {\n    // ignore\n  }\n}\n\nasync function ensureFolderStructure(rootFolder: string) {\n  const templatesDir = path.join(rootFolder, \"templates\");\n  const dailyTasksDir = path.join(rootFolder, \"daily tasks\");\n  const backgroundsDir = path.join(rootFolder, \"backgrounds\");\n  const settingsFile = path.join(rootFolder, \"settings.json\");\n\n  await fs.promises.mkdir(templatesDir, { recursive: true });\n  await fs.promises.mkdir(dailyTasksDir, { recursive: true });\n  await fs.promises.mkdir(backgroundsDir, { recursive: true });\n\n  try {\n    await fs.promises.access(settingsFile, fs.constants.F_OK);\n  } catch {\n    await fs.promises.writeFile(settingsFile, \"{}\\n\", \"utf-8\");\n  }\n}\n\nipcMain.handle(\"get-saved-folder\", async () => {\n  console.log(\"ipc:get-saved-folder\");\n  const settings = readAppSettings();\n  return settings.selectedFolder ?? null;\n});\n\nipcMain.handle(\"select-folder\", async () => {\n  console.log(\"ipc:select-folder invoked\");\n  if (!mainWindow) return null;\n  const result = await dialog.showOpenDialog(mainWindow, {\n    properties: [\"openDirectory\", \"createDirectory\"],\n  });\n  if (result.canceled || result.filePaths.length === 0) return null;\n  const folderPath = result.filePaths[0];\n\n  try {\n    await ensureFolderStructure(folderPath);\n  } catch {\n    // ignore creation errors but still return selection\n  }\n\n  const current = readAppSettings();\n  writeAppSettings({ ...current, selectedFolder: folderPath });\n  console.log(\"ipc:select-folder selected:\", folderPath);\n  return { folderPath };\n});\n\nipcMain.handle(\"list-daily-tasks\", async () => {\n  const settings = readAppSettings();\n  const rootFolder = settings.selectedFolder;\n  if (!rootFolder) return [] as { fileName: string; fullPath: string }[];\n  const tasksDir = path.join(rootFolder, \"daily tasks\");\n  try {\n    const entries = await fs.promises.readdir(tasksDir, {\n      withFileTypes: true,\n    });\n    const files = entries\n      .filter((e) => e.isFile() && e.name.toLowerCase().endsWith(\".json\"))\n      .map((e) => ({\n        fileName: e.name.replace(/\\.json$/i, \"\"),\n        fullPath: path.join(tasksDir, e.name),\n      }));\n    return files;\n  } catch {\n    return [] as { fileName: string; fullPath: string }[];\n  }\n});\n\nipcMain.handle(\"list-templates\", async () => {\n  const settings = readAppSettings();\n  const rootFolder = settings.selectedFolder;\n  if (!rootFolder) return [] as { fileName: string; fullPath: string }[];\n  const templatesDir = path.join(rootFolder, \"templates\");\n  try {\n    const entries = await fs.promises.readdir(templatesDir, {\n      withFileTypes: true,\n    });\n    const files = entries\n      .filter((e) => e.isFile() && e.name.toLowerCase().endsWith(\".json\"))\n      .map((e) => ({\n        fileName: e.name.replace(/\\.json$/i, \"\"),\n        fullPath: path.join(templatesDir, e.name),\n      }));\n    return files;\n  } catch {\n    return [] as { fileName: string; fullPath: string }[];\n  }\n});\n\nipcMain.handle(\"list-backgrounds\", async () => {\n  const settings = readAppSettings();\n  const rootFolder = settings.selectedFolder;\n  if (!rootFolder)\n    return [] as { fileName: string; fullPath: string; url: string }[];\n  const backgroundsDir = path.join(rootFolder, \"backgrounds\");\n  try {\n    const entries = await fs.promises.readdir(backgroundsDir, {\n      withFileTypes: true,\n    });\n    const exts = [\".png\", \".jpg\", \".jpeg\", \".gif\", \".webp\", \".svg\"];\n    const filePaths = entries\n      .filter(\n        (e) => e.isFile() && exts.includes(path.extname(e.name).toLowerCase())\n      )\n      .map((e) => path.join(backgroundsDir, e.name));\n\n    const results = await Promise.all(\n      filePaths.map(async (fullPath) => {\n        try {\n          const buf = await fs.promises.readFile(fullPath);\n          const ext = path.extname(fullPath).toLowerCase();\n          const mime =\n            ext === \".png\"\n              ? \"image/png\"\n              : ext === \".gif\"\n                ? \"image/gif\"\n                : ext === \".webp\"\n                  ? \"image/webp\"\n                  : ext === \".svg\"\n                    ? \"image/svg+xml\"\n                    : \"image/jpeg\";\n          const b64 = buf.toString(\"base64\");\n          const url = `data:${mime};base64,${b64}`;\n          return { fileName: path.basename(fullPath), fullPath, url };\n        } catch {\n          return { fileName: path.basename(fullPath), fullPath, url: \"\" };\n        }\n      })\n    );\n    return results;\n  } catch {\n    return [] as { fileName: string; fullPath: string; url: string }[];\n  }\n});\n\nipcMain.handle(\"get-background-data-url\", async (_evt, fullPath: string) => {\n  try {\n    const settings = readAppSettings();\n    const rootFolder = settings.selectedFolder;\n    if (!rootFolder) return null;\n    const resolved = path.resolve(fullPath);\n    const resolvedRoot = path.resolve(rootFolder);\n    if (!resolved.startsWith(resolvedRoot)) return null;\n    const ext = path.extname(resolved).toLowerCase();\n    const allowed = [\".png\", \".jpg\", \".jpeg\", \".gif\", \".webp\", \".svg\"];\n    if (!allowed.includes(ext)) return null;\n    const buf = await fs.promises.readFile(resolved);\n    const mime =\n      ext === \".png\"\n        ? \"image/png\"\n        : ext === \".gif\"\n          ? \"image/gif\"\n          : ext === \".webp\"\n            ? \"image/webp\"\n            : ext === \".svg\"\n              ? \"image/svg+xml\"\n              : \"image/jpeg\";\n    const b64 = buf.toString(\"base64\");\n    return `data:${mime};base64,${b64}`;\n  } catch {\n    return null;\n  }\n});\n\n// Read settings.json stored inside the currently selected root folder\nipcMain.handle(\"read-root-settings\", async () => {\n  try {\n    const settings = readAppSettings();\n    const rootFolder = settings.selectedFolder;\n    if (!rootFolder) return {} as Record<string, unknown>;\n    const settingsFile = path.join(rootFolder, \"settings.json\");\n    try {\n      const raw = await fs.promises.readFile(settingsFile, \"utf-8\");\n      return JSON.parse(raw) as Record<string, unknown>;\n    } catch {\n      return {} as Record<string, unknown>;\n    }\n  } catch {\n    return {} as Record<string, unknown>;\n  }\n});\n\n// Merge and write settings.json inside the currently selected root folder\nipcMain.handle(\n  \"write-root-settings\",\n  async (\n    _evt,\n    partial: Record<string, unknown> | undefined\n  ): Promise<boolean> => {\n    try {\n      const settings = readAppSettings();\n      const rootFolder = settings.selectedFolder;\n      if (!rootFolder) return false;\n      const settingsFile = path.join(rootFolder, \"settings.json\");\n      let current: Record<string, unknown> = {};\n      try {\n        const raw = await fs.promises.readFile(settingsFile, \"utf-8\");\n        current = JSON.parse(raw) as Record<string, unknown>;\n      } catch {\n        current = {};\n      }\n      const next = { ...current, ...(partial ?? {}) };\n      const content = JSON.stringify(next, null, 2) + \"\\n\";\n      await fs.promises.writeFile(settingsFile, content, \"utf-8\");\n      return true;\n    } catch {\n      return false;\n    }\n  }\n);\n\napp.on(\"window-all-closed\", () => {\n  if (process.platform !== \"darwin\") app.quit();\n});\n\napp.on(\"activate\", () => {\n  if (BrowserWindow.getAllWindows().length === 0) createMainWindow();\n});\n\nipcMain.handle(\"read-json-file\", async (_evt, fullPath: string) => {\n  try {\n    const settings = readAppSettings();\n    const rootFolder = settings.selectedFolder;\n    if (!rootFolder) return null;\n    // Ensure path is within the selected root for safety\n    const resolved = path.resolve(fullPath);\n    const resolvedRoot = path.resolve(rootFolder);\n    if (!resolved.startsWith(resolvedRoot)) return null;\n    if (!resolved.toLowerCase().endsWith(\".json\")) return null;\n    const raw = await fs.promises.readFile(resolved, \"utf-8\");\n    return JSON.parse(raw);\n  } catch {\n    return null;\n  }\n});\n\nipcMain.handle(\n  \"write-json-file\",\n  async (\n    _evt,\n    args: { fullPath: string; data: unknown } | undefined\n  ): Promise<boolean> => {\n    try {\n      if (!args || !args.fullPath) return false;\n      const { fullPath, data } = args;\n      const settings = readAppSettings();\n      const rootFolder = settings.selectedFolder;\n      if (!rootFolder) return false;\n      const resolved = path.resolve(fullPath);\n      const resolvedRoot = path.resolve(rootFolder);\n      if (!resolved.startsWith(resolvedRoot)) return false;\n      if (!resolved.toLowerCase().endsWith(\".json\")) return false;\n      const content = JSON.stringify(data, null, 2) + \"\\n\";\n      await fs.promises.writeFile(resolved, content, \"utf-8\");\n      return true;\n    } catch {\n      return false;\n    }\n  }\n);\n\nipcMain.handle(\"delete-json-file\", async (_evt, fullPath: string) => {\n  try {\n    const settings = readAppSettings();\n    const rootFolder = settings.selectedFolder;\n    if (!rootFolder) return false;\n    const resolved = path.resolve(fullPath);\n    const resolvedRoot = path.resolve(rootFolder);\n    if (!resolved.startsWith(resolvedRoot)) return false;\n    if (!resolved.toLowerCase().endsWith(\".json\")) return false;\n    await fs.promises.unlink(resolved);\n    return true;\n  } catch {\n    return false;\n  }\n});\n"],"names":["__dirname","path","fileURLToPath","mainWindow","createMainWindow","iconPathDev","windowIcon","BrowserWindow","app","devPath1","devPath2","fs","pageUrl","getAppSettingsPath","readAppSettings","filePath","raw","writeAppSettings","settings","ensureFolderStructure","rootFolder","templatesDir","dailyTasksDir","backgroundsDir","settingsFile","ipcMain","result","dialog","folderPath","current","tasksDir","e","entries","exts","filePaths","fullPath","buf","ext","mime","b64","url","_evt","resolved","resolvedRoot","partial","next","content","args","data"],"mappings":"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"}